<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>E-Vaulto | Expenses</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <!-- Chart.js -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

  <style>
* { box-sizing: border-box; }

body {
  margin: 0;
  min-height: 100vh;
  background:
    radial-gradient(circle at top left, rgba(0,255,136,0.15), transparent 40%),
    #07090c;
  color: #eaeaea;
  font-family: "Inter","Segoe UI",Arial,sans-serif;
}

.ev-back-btn {
  position: fixed;
  top: 24px;
  left: 24px;
  padding: 10px 18px;
  border-radius: 12px;
  color: #e6e6e6;
  text-decoration: none;
  background: rgba(255,255,255,0.06);
  border: 1px solid rgba(255,255,255,0.15);
  backdrop-filter: blur(12px);
  transition: all .25s ease;
}
.ev-back-btn:hover {
  color: #00ff88;
  box-shadow: 0 0 18px rgba(0,255,136,.35);
}

.container {
  max-width: 1100px;
  margin: auto;
  padding: 90px 30px 50px;
}

h1 {
  text-align: center;
  color: #00ff88;
  margin-bottom: 35px;
}

/* ================= ANALYTICS ================= */
.analytics {
  display: grid;
  grid-template-columns: 1fr 1fr;
  gap: 24px;
  margin-bottom: 35px;
}

.chart-box,
.circle-card {
  height: 260px;
  background: rgba(255,255,255,0.04);
  border-radius: 10px;
  padding: 22px;
  backdrop-filter: blur(14px);
  border: 1px solid rgba(255,255,255,0.12);
  display: flex;
  flex-direction: column;
  justify-content: center;
}

.chart-box h3,
.circle-card h3 {
  margin: 0 0 12px;
}

.pie-wrapper {
  width: 160px;
  height: 160px;
  margin: auto;
}

#pieChart {
  width: 100% !important;
  height: 100% !important;
}

/* ================= SAVINGS ================= */
.savings-box {
  align-items: center;
  text-align: center;
}

.savings-amount {
  font-size: 32px;
  font-weight: 700;
  color: #00ff88;
  margin: 16px 0;
  text-shadow: 0 0 12px rgba(0,255,136,.45);
}

/* ================= FORM ================= */
.expense-form {
  background: rgba(255,255,255,0.04);
  border-radius: 10px;
  padding: 24px;
  display: grid;
  grid-template-columns: repeat(auto-fit,minmax(160px,1fr));
  gap: 16px;
  margin-bottom: 30px;
}

.expense-form input,
.expense-form select {
  padding: 14px;
  border-radius: 12px;
  background: rgba(0,0,0,.6);
  color: #eaeaea;
  border: 1px solid rgba(255,255,255,.15);
}

.expense-form button {
  grid-column: span 2;
  padding: 15px;
  border-radius: 10px;
  border: none;
  font-weight: 600;
  cursor: pointer;
  background: linear-gradient(135deg,#00ff88,#0fbf6a);
}

/* ================= LIST ================= */
.expense-item {
  background: rgba(255,255,255,0.04);
  border-radius: 12px;
  padding: 18px;
  margin-bottom: 14px;
  display: flex;
  justify-content: space-between;
  align-items: center;
}

.delete-btn {
  background: rgba(255,0,0,.1);
  border: 1px solid rgba(255,0,0,.35);
  color: #ff4d4d;
  padding: 8px 14px;
  border-radius: 12px;
  cursor: pointer;
}

/* ================= BAR CHART ================= */
.bar-box {
  margin-top: 35px;
  background: rgba(255,255,255,0.04);
  padding: 24px;
  border-radius: 10px;
  backdrop-filter: blur(14px);
  border: 1px solid rgba(255,255,255,0.12);
}
  </style>
</head>

<body>

<a href="/dashboard" class="ev-back-btn">← Back</a>

<div class="container">
  <h1>Expense Tracker</h1>

  <div class="analytics">

    <!-- PIE -->
    <div class="chart-box">
      <h3>Spending Distribution</h3>
      <div class="pie-wrapper">
        <canvas id="pieChart"></canvas>
      </div>
    </div>

    <!-- SAVINGS -->
    <div class="circle-card savings-box">
      <h3>Savings</h3>
      <div class="savings-amount">₹ <%= savingsTotal %></div>
      <small>Total saved</small>
    </div>

  </div>

  <!-- FORM -->
  <form class="expense-form" action="/expenses/add" method="POST">
    <input id="titleInput" name="title" placeholder="Title" required>
    <input type="number" step="0.01" name="amount" placeholder="Amount" required>

    <select id="categorySelect" name="category" required>
      <option value="">Category</option>
      <option>Food</option>
      <option>Groceries</option>
      <option>Transport</option>
      <option>Shopping</option>
      <option>Medical</option>
      <option>Entertainment</option>
      <option>Savings</option>
      <option>Education</option>
      <option>Vacation</option>
      <option>Others</option>
    </select>

    <button>Add Expense</button>
  </form>

  <!-- LIST -->
  <% expenses.forEach(exp => { %>
    <div class="expense-item">
      <div>
        <strong><%= exp.title %></strong><br>
        <small><%= exp.category %> | ₹ <%= exp.amount %></small>
      </div>
      <form action="/expenses/delete/<%= exp.id %>" method="POST">
        <button class="delete-btn">Delete</button>
      </form>
    </div>
  <% }) %>

  <!-- BAR CHART -->
  <div class="bar-box">
    <h3>Monthly Spending</h3>
    <canvas id="monthlyChart"></canvas>
  </div>

</div>

<script>
const pieData = <%- JSON.stringify(pieData) %>;
const monthlyData = <%- JSON.stringify(monthlyData) %>;
const months = ["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];

/* PIE */
if (pieData.length) {
  new Chart(pieChart, {
    type: "pie",
    data: {
      labels: pieData.map(p => p.category),
      datasets: [{ data: pieData.map(p => p.total) }]
    }
  });
}

/* BAR */
new Chart(monthlyChart, {
  type: "bar",
  data: {
    labels: monthlyData.map(m => months[m.month - 1]),
    datasets: [{
      label: "Monthly Spending",
      data: monthlyData.map(m => m.total),
      borderRadius: 8
    }]
  }
});

  const categorySelect = document.getElementById("categorySelect");
  const titleInput = document.getElementById("titleInput");

  categorySelect.addEventListener("change", () => {
    if (categorySelect.value === "Savings") {
      titleInput.value = "Savings";
      titleInput.readOnly = true;   // lock it (optional but clean UX)
    } else {
      if (titleInput.value === "Savings") {
        titleInput.value = "";
      }
      titleInput.readOnly = false;
    }
  });

</script>

</body>
</html>
